project/
â”‚â”€â”€ main.py
â”‚â”€â”€ dal.py
â”‚â”€â”€ requirements.txt
â”‚â”€â”€ Dockerfile



from pymongo import MongoClient

class MongoDAL:
    def __init__(self, uri: str, db_name: str, collection: str):
        self.client = MongoClient(uri)
        self.db = self.client[db_name]
        self.collection = self.db[collection]

    def insert_one(self, data: dict):
        return self.collection.insert_one(data).inserted_id

    def find_all(self):
        return list(self.collection.find({}, {"_id": 0}))  # ×‘×œ×™ _id

    def find_by_field(self, field: str, value: str):
        return list(self.collection.find({field: value}, {"_id": 0}))


from fastapi import FastAPI
from dal import MongoDAL

app = FastAPI()

# ×©× ×”×§×•× ×˜×™×™× ×¨ ×©×œ MongoDB ×™×”×™×” "mongodb"
mongo = MongoDAL(uri="mongodb://mongodb:27017/", db_name="mydb", collection="users")

@app.post("/users")
async def create_user(user: dict):
    user_id = mongo.insert_one(user)
    return {"inserted_id": str(user_id)}

@app.get("/users")
async def get_users():
    return mongo.find_all()

@app.get("/users/{field}/{value}")
async def get_user_by_field(field: str, value: str):
    return mongo.find_by_field(field, value)


fastapi
uvicorn[standard]
pymongo


FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]



docker network create my_network
docker pull mongodb/mongodb-community-server:latest

docker run -d --name mongodb --network my_network -p 27017:27017 mongodb/mongodb-community-server:latest
docker build -t my_app .
docker run -d --name my_app --network my_network -p 8000:8000 my_app
×©×œ×‘ 4: ×‘×“×™×§×”

×”×•×¡×£ ××©×ª××©:
curl -X POST "http://localhost:8000/users" -H "Content-Type: application/json" -d '{"name":"David","age":30}'
×©×œ×•×£ ××ª ×›×œ ×”××©×ª××©×™×:

curl http://localhost:8000/users
ğŸ“Œ ×¡×™×›×•×

MongoDB ×¨×¥ ×‘×§×•× ×˜×™×™× ×¨ ××—×“.

FastAPI ×¨×¥ ×‘×§×•× ×˜×™×™× ×¨ ××—×¨.

×©× ×™×”× ××—×•×‘×¨×™× ×“×¨×š Docker Network.

×”×§×•×“ ×©×œ×š × ×™×’×© ×œÖ¾MongoDB ×œ×¤×™ ×©× ×”×§×•× ×˜×™×™× ×¨ (mongodb) ×•×œ× ×œ×¤×™ IP.




×¢×•×“ ××•×¤×¦×™×”
from fastapi import FastAPI
from pydantic import BaseModel
from dal import MongoDAL

app = FastAPI()

# ×©× ×”×§×•× ×˜×™×™× ×¨ ×©×œ MongoDB ×™×”×™×” "mongodb"
mongo = MongoDAL(uri="mongodb://mongodb:27017/", db_name="mydb", collection="users")

# ××•×“×œ × ×ª×•× ×™×
class User(BaseModel):
    name: str
    age: int

@app.post("/users")
async def create_user(user: User):
    user_id = mongo.insert_one(user.dict())  # ×”××¨×” ×œÖ¾dict
    return {"inserted_id": str(user_id)}

@app.get("/users")
async def get_users():
    return mongo.find_all()

@app.get("/users/{field}/{value}")
async def get_user_by_field(field: str, value: str):
    return mongo.find_by_field(field, value)

××” ×”×©×ª× ×” ×›××Ÿ?

×‘××§×•× ×œ×§×‘×œ user: dict â†’ ×¢×›×©×™×• ×–×” user: User.

FastAPI ×™×¢×©×” ×•×œ×™×“×¦×™×” ×œ×¤×™ ×”Ö¾schema ×©×œ User.

user.dict() ×”×•×¤×š ××ª ×”Ö¾User ×—×–×¨×” ×œÖ¾dict ×œ×¤× ×™ ×©××›× ×™×¡×™× ×œÖ¾MongoDB.


×™×ª×¨×•×Ÿ × ×•×¡×£

×‘Ö¾Swagger UI (http://localhost:8000/docs) ×ª×¨××” ××ª ×”××•×“×œ ×‘×¦×•×¨×” ××¡×•×“×¨×ª:

{
  "name": "David",
  "age": 30
}

×¢×•×“ ××•×¤×¦×™×”
from fastapi import FastAPI
from pydantic import BaseModel
from dal import MongoDAL

app = FastAPI()

# ×—×™×‘×•×¨ ×œÖ¾MongoDB (×©× ×”×§×•× ×˜×™×™× ×¨: mongodb)
mongo = MongoDAL(uri="mongodb://mongodb:27017/", db_name="mydb", collection="users")

# --- ××•×“×œ×™× ---

# ×§×œ×˜: ××©×ª××© ×©× ×›× ×¡
class UserIn(BaseModel):
    name: str
    age: int

# ×¤×œ×˜: ××©×ª××© ×©×™×•×¦×
class UserOut(BaseModel):
    name: str
    age: int

# ×¤×œ×˜: ×ª×’×•×‘×” ××—×¨×™ ×™×¦×™×¨×”
class CreateResponse(BaseModel):
    inserted_id: str


# --- ×¨××•×˜×™× ---

@app.post("/users", response_model=CreateResponse)
async def create_user(user: UserIn):
    user_id = mongo.insert_one(user.dict())  # ×”××¨×” ×œÖ¾dict
    return {"inserted_id": str(user_id)}


@app.get("/users", response_model=list[UserOut])
async def get_users():
    return mongo.find_all()


@app.get("/users/{field}/{value}", response_model=list[UserOut])
async def get_user_by_field(field: str, value: str):
    return mongo.find_by_field(field, value)


import requests

# GET
response = requests.get("http://localhost:8000/users")

# POST
response = requests.post("http://localhost:8000/users", json={"name": "David"})





